{% include 'index_nav.html' %}
{% load static %}
    <section class="banner_area">
      <div class="banner_inner d-flex align-items-center">
        <div class="container">
          <div
            class="banner_content d-md-flex justify-content-between align-items-center">
            <div class="mb-3 mb-md-0">
              <h2 style="color:#ed0f07;">Cart</h2>
              <p>Very us move be blessed multiply night</p>
            </div>
            <div class="page_link">
              <a href="/" style="color:#ed0f07;">Home</a>
              <a href="/cart/" style="color:#ed0f07;">Cart</a>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!--================End Home Banner Area =================-->

    <!--================Cart Area =================-->
    <section class="cart_area">
      <div class="container">
        <div class="cart_inner">
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th scope="col">Product</th>
                  <th>Size/Color</th>
                  <th scope="col">Price</th>
                  <th scope="col">Quantity</th>
                  <th scope="col">Total</th>
                </tr>
              </thead>
              <tbody>
              {% for i in cart_items %}
                <tr>
                  <td>
                    <div class="media">
                      <div class="d-flex">
                        <img
                          src="{{i.product.image.url}}"
                          alt="" width="100" height="100"
                        />
                      </div>
                      <div class="media-body">
                        <p>{{i.product.name}}</p>
                      </div>
                    </div>
                  </td>
                   <td>
                     {% if i.selected_size %}
                    <h5>{{i.selected_size}}</h5>
                     {% endif %}
                     {% if i.selected_color %}
                    <h5>{{i.selected_color}}</h5>
                     {% endif %}
                  </td>
                  <td>
                    <h5>{{i.product.price}}</h5>
                  </td>
                  <td>
                  <div class="product_count">
                    <input
                      type="text"
                      name="qty"
                      id="qty-{{i.id}}"
                      value="{{i.quantity}}"
                      class="input-text qty"
                      readonly/>
                    <button
                      onclick="updateQuantity({{i.id}}, 1)"
                      class="increase items-count"
                      type="button">
                      <i class="lnr lnr-chevron-up"></i>
                    </button>
                      <button
                        onclick="updateQuantity({{i.id}}, -1)"
                        class="reduced items-count"
                        type="button">
                        <i class="lnr lnr-chevron-down"></i>
                      </button>
                    </div>
                  </td>

                    <td>
            <h5 id="total-{{i.id}}">{{i.total_price}}</h5>
                  </td>
                  <td><a href="/remove_from_cart/{{i.id}}" class="main_btn">Remove</a></td>
                </tr>
              {% endfor %}
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>
                    <h5>Subtotal</h5>
                  </td>

                     <td><h5 id="cart-subtotal">{{ sub_total|floatformat:2 }}</h5></td>

                </tr>

                <tr class="out_button_area">
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>
                    <div class="checkout_btn_inner">
                      <a class="gray_btn" href="/products/">Continue Shopping</a>
                      <a class="main_btn" href="/checkout/">Proceed to checkout</a>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
    <!--================End Cart Area =================-->

    <!--================ start footer Area  =================-->
    <footer class="footer-area section_gap">
      <div class="container">
        <div class="row">
          <div class="col-lg-2 col-md-6 single-footer-widget">
            <h4>Top Products</h4>
            <ul>
              <li><a href="#">Managed Website</a></li>
              <li><a href="#">Manage Reputation</a></li>
              <li><a href="#">Power Tools</a></li>
              <li><a href="#">Marketing Service</a></li>
            </ul>
          </div>
          <div class="col-lg-2 col-md-6 single-footer-widget">
            <h4>Quick Links</h4>
            <ul>
              <li><a href="#">Jobs</a></li>
              <li><a href="#">Brand Assets</a></li>
              <li><a href="#">Investor Relations</a></li>
              <li><a href="#">Terms of Service</a></li>
            </ul>
          </div>
          <div class="col-lg-2 col-md-6 single-footer-widget">
            <h4>Features</h4>
            <ul>
              <li><a href="#">Jobs</a></li>
              <li><a href="#">Brand Assets</a></li>
              <li><a href="#">Investor Relations</a></li>
              <li><a href="#">Terms of Service</a></li>
            </ul>
          </div>
          <div class="col-lg-2 col-md-6 single-footer-widget">
            <h4>Resources</h4>
            <ul>
              <li><a href="#">Guides</a></li>
              <li><a href="#">Research</a></li>
              <li><a href="#">Experts</a></li>
              <li><a href="#">Agencies</a></li>
            </ul>
          </div>
          <div class="col-lg-4 col-md-6 single-footer-widget">
            <h4>Newsletter</h4>
            <p>You can trust us. we only send promo offers,</p>
            <div class="form-wrap" id="mc_embed_signup">
              <form target="_blank" action="https://spondonit.us12.list-manage.com/subscribe/post?u=1462626880ade1ac87bd9c93a&amp;id=92a4423d01"
                method="get" class="form-inline">
                <input class="form-control" name="EMAIL" placeholder="Your Email Address" onfocus="this.placeholder = ''"
                  onblur="this.placeholder = 'Your Email Address '" required="" type="email">
                <button class="click-btn btn btn-default">Subscribe</button>
                <div style="position: absolute; left: -5000px;">
                  <input name="b_36c4fd991d266f23781ded980_aefe40901a" tabindex="-1" value="" type="text">
                </div>
  
                <div class="info"></div>
              </form>
            </div>
          </div>
        </div>
        <div class="footer-bottom row align-items-center">
          <p class="footer-text m-0 col-lg-8 col-md-12"><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
          <div class="col-lg-4 col-md-12 footer-social">
            <a href="#"><i class="fa fa-facebook"></i></a>
            <a href="#"><i class="fa fa-twitter"></i></a>
            <a href="#"><i class="fa fa-dribbble"></i></a>
            <a href="#"><i class="fa fa-behance"></i></a>
          </div>
        </div>
      </div>
    </footer>
    <!--================ End footer Area  =================-->

<script>
function updateQuantity(cartId, change) {
    let input = document.getElementById("qty-" + cartId);
    let newQty = parseInt(input.value) + change;
    if (newQty < 1) return; // prevent zero or negative qty

    fetch("{% url 'update_cart' %}", {
        method: "POST",
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
            "Content-Type": "application/x-www-form-urlencoded",
        },
        body: "cart_id=" + cartId + "&quantity=" + newQty,
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            input.value = newQty;
            // update product total
            document.querySelector("#total-" + cartId).innerText = data.new_total;
            // update subtotal
            document.querySelector("#cart-subtotal").innerText = data.subtotal;
        }
    });
}
</script>